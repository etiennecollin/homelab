---
services:
  nut-upsd:
    container_name: "nut-upsd"
    image: "instantlinux/nut-upsd:2.8.2-r2"
    restart: "unless-stopped"
    devices:
      - "/dev/bus/usb"
    env_file:
      - "./secret.env"
    environment:
      API_USER: "upsmon"
      NAME: "eaton_9px1500rtn-l"
      DESCRIPTION: "Server Rack UPS"
      DRIVER: "usbhid-ups"
      PORT: "auto"
    networks:
      - "nut"

  peanut:
    container_name: "peanut"
    image: "brandawg93/peanut:5.13.0"
    volumes:
      - "./config:/config"
    restart: "unless-stopped"
    networks:
      - "proxy"
      - "nut"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.peanut.rule=Host(`peanut.${DOMAIN}`)"
      - "traefik.http.services.peanut.loadbalancer.server.port=8080"

networks:
  proxy:
    external: "true"
  nut:
    name: "nut"
