---
services:
  ntfy:
    image: "binwiederhier/ntfy"
    container_name: "ntfy"
    restart: "unless-stopped"
    command:
      - "serve"
    environment:
      TZ: ${TIMEZONE}
    volumes:
      - "./cache:/var/cache/ntfy"
      - "./config:/etc/ntfy"
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q --tries=1 https://ntfy.${DOMAIN}/v1/health -O - | grep -Eo '\"healthy\"\\s*:\\s*true' || exit 1",
        ]
      interval: "60s"
      timeout: "10s"
      retries: "3"
      start_period: "40s"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.ntfy.rule=Host(`ntfy.${DOMAIN}`)"
      - "traefik.http.services.ntfy.loadbalancer.server.port=80"
    networks:
      - "proxy"

networks:
  proxy:
    external: "true"
